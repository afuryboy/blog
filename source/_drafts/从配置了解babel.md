---
title: ä»é…ç½®äº†è§£babel(åŸºç¡€ç¯‡)
tag: babel
---

# å‰è¨€
> ä»åŸºç¡€çš„é…ç½®å»äº†è§£babel

# æŸ¥æ‰¾è¡Œä¸º

Babel ä¼šåœ¨æ­£åœ¨è¢«è½¬å½•çš„æ–‡ä»¶çš„å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ª `.babelrc` æ–‡ä»¶ã€‚ å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¼šéå†ç›®å½•æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ª `.babelrc` æ–‡ä»¶ï¼Œæˆ–ä¸€ä¸ª `package.json` æ–‡ä»¶ä¸­æœ‰ `"babel": {}`

# é…ç½®é¡¹

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€æ®µ`.babelrc`é…ç½®,è¿™é‡Œçš„é…ç½®é€‰è‡ª`vue-cli`åˆå§‹åŒ–`webpack`æ¨¡ç‰ˆé‡Œçš„é»˜è®¤.babelrcé…ç½®

```json
{
  "presets": [
    ["env", {
      "modules": false,
      "targets": {
        "browsers": ["> 1%", "last 2 versions", "not ie <= 8"]
      }
    }],
    "stage-2"
  ],
  "plugins": ["transform-vue-jsx", "transform-runtime"],
  "env": {
    "test": {
      "presets": ["env", "stage-2"],
      "plugins": ["transform-vue-jsx", "transform-es2015-modules-commonjs", "dynamic-import-node"]
    }
  }
}
```

å˜¿ï¼Œæ‰«ä¸€çœ¼ä¹ŸæŒºç®€å•çš„ä¹ˆä¸æ˜¯å¾ˆå¤šå˜›ğŸ˜¬ , æ²¡é”™è¿™æ˜¯æœ€å¸¸ç”¨çš„é…ç½®é€‰é¡¹ï¼Œ`babel` å®é™…å¯é€‰é…ç½®é¡¹æœ‰30æ¥ä¸ªğŸ˜±.

1ã€`presets` é¢„è®¾,ä¸€ä¸ª babel æ’ä»¶çš„æ•°ç»„ ï¼ˆå®é™…è·Ÿ`plugins`æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåªä¸è¿‡æ˜¯ä»¥é›†åˆçš„å½¢å¼ï¼‰

2ã€`plugins` æ’ä»¶,éœ€è¦åŠ è½½å’Œä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨

3ã€`env` ç‰¹å®šç¯å¢ƒé…ç½®,ç‰¹å®šç¯å¢ƒçš„è®¾ç½®é¡¹ä¼šè¢«åˆå¹¶ã€è¦†ç›–åˆ°æ²¡æœ‰ç‰¹å®šç¯å¢ƒçš„è®¾ç½®é¡¹ä¸­ã€‚`env` é€‰é¡¹çš„å€¼å°†ä» `process.env.BABEL_ENV` è·å–ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™è·å– `process.env.NODE_ENV` çš„å€¼ï¼Œå®ƒä¹Ÿæ— æ³•è·å–æ—¶ä¼šè®¾ç½®ä¸º `"development"`ã€‚è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå¦‚æœ ä½ çš„ç¯å¢ƒå˜é‡æ˜¯`test`é‚£ä¹ˆ`env`ä¸‹é¢çš„`test`çš„presetså’Œpluginsä¼šå’Œ1ã€2ä¸­çš„presetsã€pluginsåˆå¹¶ã€‚


âš ï¸ `Plugin/Preset` æ’åº
  - Plugin ä¼šè¿è¡Œåœ¨ Preset ä¹‹å‰ã€‚
  - Plugin ä¼šä»ç¬¬ä¸€ä¸ªå¼€å§‹é¡ºåºæ‰§è¡Œã€‚ordering is first to last.
  - Preset çš„é¡ºåºåˆ™åˆšå¥½ç›¸å(ä»æœ€åä¸€ä¸ªé€†åºæ‰§è¡Œ)ã€‚

# Plugin/Preset ç®€å†™

> å¦‚æœä½ ä½¿ç”¨ babel-plugin- ä½œä¸º plugin çš„å‰ç¼€ï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å†™çš„å½¢å¼çœç•¥æ‰è¯¥å‰ç¼€

# Plugin å’Œ Preset é…ç½®é€‰é¡¹ã€‚

> Plugin å’Œ Preset å‡å¯ä»¥é€šè¿‡å°†åç§°å’Œé€‰é¡¹å¯¹è±¡æ”¾ç½®åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­æ¥æŒ‡å®šå…¶é€‰é¡¹ã€‚

  ```js
  {
    "plugins": [
      ["transform-async-to-module-method", {
        "module": "bluebird",
        "method": "coroutine"
      }]
    ]
  }
  ```
  ```js
  {
    "presets": [
      ["es2015", {
        "loose": true,
        "modules": false
      }]
    ]
  }
  ```
å…·ä½“é…ç½®è¯·å‚è€ƒ[babel-preset-envé…ç½®](https://babeljs.cn/docs/plugins/preset-env/#%E9%80%89%E9%A1%B9)

åœ¨æ²¡æœ‰ä»»ä½•é…ç½®é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œbabel-preset-env ä¸ babel-preset-latestï¼ˆæˆ–è€…babel-preset-es2015ï¼Œbabel-preset-es2016å’Œbabel-preset-es2017ä¸€èµ·ï¼‰çš„è¡Œä¸ºå®Œå…¨ç›¸åŒ

# transform-runtime
  - å®ƒè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

    åœ¨[transform-runtime](https://github.com/babel/babel/tree/a10c91790f890d55396c7517aa3dc3f0b8f8aebc/packages/babel-plugin-transform-runtime)æ–‡æ¡£ä¸Šå¼€å¤´æœ‰è¿™ä¹ˆä¸€å¥
    
    `Externalise references to helpers and built-ins, automatically polyfilling your code without polluting globals. (This plugin is recommended in a library/tool)`

    ç¿»è¯‘è¿‡æ¥ï¼šå¤–éƒ¨å¼•ç”¨åŠ©æ‰‹å’Œå†…ç½®æ’ä»¶ï¼Œè‡ªåŠ¨å¡«å……ä»£ç è€Œä¸ä¼šæ±¡æŸ“å…¨å±€ã€‚ ï¼ˆè¿™ä¸ªæ’ä»¶æ˜¯åœ¨åº“/å·¥å…·ä¸­æ¨èçš„ï¼‰
    
    å®é™…ä¸Š `transform-runtime` å®ƒæ˜¯é…åˆ `babel-runtime` å®ç°polyfill çš„åŠŸèƒ½ã€‚å› ä¸ºä¸ä¼šåƒ `babel-polyfill`é‚£æ ·ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼Œæ‰€ä»¥é€‚åˆåœ¨ç¬¬ä¸‰æ–¹çš„åº“å’Œæ’ä»¶ä¸­ä½¿ç”¨ã€‚
 
    âš ï¸ æ³¨æ„ï¼šä¾‹å¦‚ `"foobar".includes("foo")` ç­‰å®ä¾‹æ–¹æ³•å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºè¿™éœ€è¦ä¿®æ”¹ç°æœ‰çš„å†…ç½®æ’ä»¶ï¼ˆæ­¤æ—¶ä½¿ç”¨ `babel-polyfill`ï¼‰

    æ‰€ä»¥æˆ‘è®¤ä¸ºï¼Œå®é™…ä¸Šbabelå¸Œæœ›ç¬¬ä¸‰æ–¹çš„åº“ï¼å·¥å…·åŒ…ä½¿ç”¨ `transform-runtime` + `babel-runtime` å»ç¼–è¯‘ä»£ç ï¼Œä¿è¯ä¸ä¼šå½±å“åˆ°å¤–éƒ¨ã€‚è€Œå®é™…ä¸Šæˆ‘ä»¬é¡¹ç›®ä¸­åº”è¯¥è¿˜æ˜¯`babel-polyfill`ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚

# babel-runtime
  
  - åŒ…æ‹¬helper å‡½æ•°æ¨¡å—
    
    Babel ä½¿ç”¨äº†éå¸¸å°çš„ helpers æ¥å®ç°è¯¸å¦‚ `_extend` ç­‰å¸¸ç”¨åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¢«æ·»åŠ åˆ°æ¯ä¸ªé€šè¿‡ require å¼•ç”¨å®ƒçš„æ–‡ä»¶ä¸­ã€‚è¿™ç§é‡å¤ï¼ˆæ“ä½œï¼‰æœ‰æ—¶æ˜¯ä¸å¿…è¦çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ çš„åº”ç”¨ç¨‹åºè¢«æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶æ—¶ã€‚

    è¿™æ—¶åˆ™éœ€è¦ä½¿ç”¨ `transform-runtime`ï¼šæ‰€æœ‰çš„ helper éƒ½ä¼šå¼•ç”¨æ¨¡å— `babel-runtime`ï¼Œä»¥é¿å…ç¼–è¯‘è¾“å‡ºçš„é‡å¤é—®é¢˜ã€‚è¿™ä¸ªè¿è¡Œæ—¶ä¼šè¢«ç¼–è¯‘åˆ°ä½ çš„æ„å»ºç‰ˆæœ¬å½“ä¸­ã€‚

  - å†…ç½®pollfillæ’ä»¶

    è¿™ä¸ªè½¬è¯‘å™¨çš„å¦å¤–ä¸€ä¸ªç›®çš„å°±æ˜¯ä¸ºä½ çš„ä»£ç åˆ›å»ºä¸€ä¸ªæ²™ç›’ç¯å¢ƒã€‚å¦‚æœä½ ä½¿ç”¨äº† `babel-polyfill`ï¼Œå®ƒæä¾›äº†è¯¸å¦‚ `Promise`ï¼Œ`Set` ä»¥åŠ `Map` ä¹‹ç±»çš„å†…ç½®æ’ä»¶ï¼Œè¿™äº›å°†æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚è™½ç„¶è¿™å¯¹äºåº”ç”¨ç¨‹åºæˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è¯´å¯èƒ½æ˜¯å¥½äº‹ï¼Œä½†å¦‚æœä½ çš„ä»£ç æ‰“ç®—å‘å¸ƒä¸ºä¾›å…¶ä»–äººä½¿ç”¨çš„åº“ï¼Œæˆ–ä½ æ— æ³•å®Œå…¨æ§åˆ¶ä»£ç è¿è¡Œçš„ç¯å¢ƒï¼Œåˆ™ä¼šæˆä¸ºé—®é¢˜ã€‚

    è½¬è¯‘å™¨å°†è¿™äº›å†…ç½®æ’ä»¶èµ·äº†åˆ«å `core-js`ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ— ç¼çš„ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶ä¸”æ— éœ€ä½¿ç”¨ `polyfill`ã€‚

# babel-polyfill  
  > å®ƒä¼šä»¿æ•ˆä¸€ä¸ªå®Œæ•´çš„ `ES2015+` ç¯å¢ƒï¼Œå¹¶æ„å›¾è¿è¡Œäºä¸€ä¸ªåº”ç”¨ä¸­è€Œä¸æ˜¯ä¸€ä¸ªåº“/å·¥å…·ã€‚è¿™ä¸ª `polyfill` ä¼šåœ¨ä½¿ç”¨ `babel-node` æ—¶è‡ªåŠ¨åŠ è½½ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æ–°çš„å†…ç½®å¯¹è±¡æ¯”å¦‚ `Promise` æˆ–è€… `WeakMap`, é™æ€æ–¹æ³•æ¯”å¦‚ `Array.from` æˆ–è€… `Object.assign`, å®ä¾‹æ–¹æ³•æ¯”å¦‚ `Array.prototype.includes` å’Œç”Ÿæˆå™¨å‡½æ•°ï¼ˆæä¾›ç»™ä½ ä½¿ç”¨ `regenerator` æ’ä»¶ï¼‰ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œ `polyfill` æ·»åŠ åˆ°äº†å…¨å±€èŒƒå›´ï¼Œå°±åƒåŸç”Ÿç±»å‹æ¯”å¦‚ `String` ä¸€æ ·ã€‚

  - å¼•å…¥

  ```js
    import "babel-polyfill"; // å¦‚æœä½ åœ¨ä½ çš„åº”ç”¨å…¥å£ä½¿ç”¨ ES6 çš„ import è¯­æ³•ï¼Œä½ éœ€è¦åœ¨å…¥å£é¡¶éƒ¨é€šè¿‡ import å°† polyfill å¼•å…¥ï¼Œä»¥ç¡®ä¿å®ƒèƒ½å¤Ÿæœ€å…ˆåŠ è½½ï¼š
  ```
  or åœ¨ `webpack.config.js` ä¸­ï¼Œå°† `babel-polyfill` åŠ åˆ°ä½ çš„ `entry` æ•°ç»„ä¸­
  ```js
  module.exports = {
    entry: ["babel-polyfill", "./app/js"]
  };
  ```

 âš ï¸ å› ä¸ºè¿™æ˜¯ä¸€ä¸ª `polyfill` ï¼ˆå®ƒéœ€è¦åœ¨ä½ çš„æºä»£ç ä¹‹å‰è¿è¡Œï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæˆä¸ºä¸€ä¸ª `dependency`, è€Œä¸æ˜¯ä¸€ä¸ª `devDependency`.
# å‚è€ƒèµ„æ–™

[babelä¸­æ–‡](https://babeljs.cn/)
[é˜®ä¸€å³°çš„Babel å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2016/01/babel.html)